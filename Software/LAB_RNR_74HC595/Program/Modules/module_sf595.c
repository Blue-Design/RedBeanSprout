/*====================================================================================================*/
/*====================================================================================================*/
#include "stm32f1_system.h"
#include "module_sf595.h"
/*====================================================================================================*/
/*====================================================================================================*/
#define SF595_DI    PBO(12)
#define SF595_OE    PBO(13)
#define SF595_ST    PBO(14)
#define SF595_SH    PBO(15)
#define SF595_MR    PBO(0)
/*====================================================================================================*/
/*====================================================================================================*
**函數 : SF595_Config
**功能 : 74HC595 Config
**輸入 : None
**輸出 : None
**使用 : SF595_Config();
**====================================================================================================*/
/*====================================================================================================*/
void SF595_Config( void )
{
  GPIO_InitTypeDef GPIO_InitStruct;

  RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB, ENABLE);

  GPIO_InitStruct.GPIO_Pin = GPIO_Pin_12 | GPIO_Pin_13 | GPIO_Pin_14 | GPIO_Pin_15;
  GPIO_InitStruct.GPIO_Speed = GPIO_Speed_50MHz;
  GPIO_InitStruct.GPIO_Mode = GPIO_Mode_Out_PP;
  GPIO_Init(GPIOB, &GPIO_InitStruct);
}
/*====================================================================================================*/
/*====================================================================================================*
**函數 : SF595_Init
**功能 : 74HC595 Init
**輸入 : None
**輸出 : None
**使用 : SF595_Init();
**====================================================================================================*/
/*====================================================================================================*/
void SF595_Init( void )
{
  SF595_DI = 0;
  SF595_OE = 0;
  SF595_ST = 0;
  SF595_SH = 0;
  SF595_MR = 1;

  SF595_Reset();
  SF595_OutputEnable(ENABLE);
}
/*====================================================================================================*/
/*====================================================================================================*
**函數 : SF595_Reset
**功能 : Reset 74HC595
**輸入 : None
**輸出 : None
**使用 : SF595_Reset();
**====================================================================================================*/
/*====================================================================================================*/
void SF595_Reset( void )
{
  SF595_MR = 0;
  Delay_1ms(1);
  SF595_MR = 1;
  Delay_1ms(1);
}
/*====================================================================================================*/
/*====================================================================================================*
**函數 : SF595_OutputEnable
**功能 : 74HC595 Output Enable
**輸入 : None
**輸出 : None
**使用 : SF595_OutputEnable(ENABLE);
**====================================================================================================*/
/*====================================================================================================*/
void SF595_OutputEnable( u8 OutputState )
{
  SF595_OE = (OutputState) ? 0 : 1; // active LOW
}
/*====================================================================================================*/
/*====================================================================================================*
**函數 : SF595_Shift
**功能 : Shift bit
**輸入 : SendData
**輸出 : None
**使用 : SF595_Shift(1);
**====================================================================================================*/
/*====================================================================================================*/
void SF595_Shift( u8 SendData )
{
  u8 tmp = 0;

  SF595_SH = 0;
  SF595_ST = 0;
  tmp = SendData & 0x01;
  SF595_DI = tmp;
  SF595_SH = 1;
  SF595_ST = 1;
}
/*====================================================================================================*/
/*====================================================================================================*
**函數 : SF595_SendByte
**功能 : Shift 8 bits
**輸入 : SendData
**輸出 : None
**使用 : SF595_SendByte(SendData);
**====================================================================================================*/
/*====================================================================================================*/
void SF595_SendByte( u8 SendData )
{
  u8 i = 0;
  u8 tmp = 0;

  for(i=0; i<8; i++) {
    SF595_SH = 0;
    SF595_ST = 0;
    tmp = (SendData & (0x80>>i)) ? 1 : 0;
    SF595_DI = tmp;
    SF595_SH = 1;
    SF595_ST = 1;
  }
}
/*====================================================================================================*/
/*====================================================================================================*/
